### Resumen

En Chile existe la gran preocupación entre distintas empresas,
debido a una serie de vulnerabilidades en equipos UPS de
respaldo de energía que podría poner en jaque el suministro
eléctrico y sus equipos conectados.

Se ha publicado recientemente diversos problemas en los sistemas
UPS de protección de energía de la empresa APC los cuales pueden
comprometer el sistema de suministro en una empresa. Lo más
preocupante es que esta vulnerabilidad puede ser aprovechada de
manera remota y **puede provocar un daño físico a los
equipos**.

Este grupo de vulnerabilidades ha sido llamada TLStorm y se ha
catalogado por los expertos como una de las vulnerabilidades más
preocupantes de lo que va del año.

Cabe mencionar que estos equipos de protección de energía son
componentes críticos para distintas infraestructuras, tales como
de gobierno, salud, seguridad física en general, centros de
datos y similares.


### El riesgo

A continuación, se desglosa el riesgo por cada vulnerabilidad:

- **CVE-2022-22806** de severidad crítica, con una puntuación CVSS3 9.0. Esta vulnerabilidad se debe a errores de la biblioteca nanoSSL, provocando un problema de estado en el protocolo de enlace TLS, omitiendo la autenticación de este (TLS), con lo cual permitiría a un atacante remoto no autenticado la ejecución remota de código (RCE).
- **CVE-2022-22805** de severidad crítica, con una puntuación CVSS3 9.0. Esta vulnerabilidad se debe a errores de la biblioteca nanoSSL, provocando un error de corrupción de memoria en el reensamblaje de paquetes. Un atacante remoto no autenticado podría aprovechar el error de biblioteca nanoSSL y realizar ejecución remota de código (RCE).
- **CVE-2022-0715** de severidad crítica, con una puntuación CVSS 9.0. Esta vulnerabilidad se debe a una falla de diseño, en la que las actualizaciones de firmware en los dispositivos afectados no se firman criptográficamente de manera segura. Un atacante podría aprovechar esta vulnerabilidad y crear firmware malintencionado e instalarlo mediante varias rutas, como Internet, LAN o una unidad USB, provocando la ejecución remota de código (RCE).


### Algunas fuentes

- https://nvd.nist.gov/vuln/detail/CVE-2022-22806
- https://www.cert.gov.py/noticias/vulnerabilidades-criticas-en-los-dispositivos-smart-ups-de-apc
- https://www.armis.com/research/tlstorm/
- https://underc0de.org/foro/noticias-informaticas-120/los-errores-de-dia-cero-de-apc-ups-pueden-quemar-dispositivos-de-forma-remota/


### Análisis del impacto

Según fuentes oficiales, el problema principal reside en la
**implementación de SSL/TLS**, un protocolo ámpliamente
utilizado para el resguardo de la comunicación entre servicios
bajo TCP, pero en este caso el componente afectado es la
funcionalidad de **SmartConnect** el cual se encarga de la
comunicación entre diferentes dispositivos de Smart-UPS.
Directamente hablando se trata de la **ejecución de código
debido a la corrupción de memoria** por a un desbbordamiento
no controlado.

Adicionalmente a este problema, también cuenta con otra
vulnerabilidad totalmente distinta la cual permite a un
delincuente informático a **evadir el mecanismo de encriptado
del Firmware** debido a que este carece de una llave
criptográfica.

Estas dos vulnerabilidades juntas **pueden permitir a un atacante
dentro de la red local del equipo afectado, corromper la memoria
de estos equipos e instalar un nuevo firmware infectado**.

Hay que recordar que estos equipos mantienen una conectividad de
manera física con los componentes electrónicos **sin ningún
mecanismo de tipo Sandboxing o isolación** que pudiesen
proteger al circuito eléctrico de posibles ataques vía Software
como si lo hace una placa madre de un computador, servidor o
dispositivo móvil. Esto abre la posibilidad de **estropear
físicamente los componentes a traves del cambio de voltaje,
interrupciones y similares**.


### Recomendaciones a los usuarios

Schneider Electric ha publicado recientemente
[una actualización de seguridad crítica](https://download.schneider-electric.com/files?p_Doc_Ref=SEVD-2022-067-02)
que soluciona este problema, por lo cual se recomienda aplicar este parche lo
antes posible.

[El grupo de investigación Armis](https://www.armis.com/research/tlstorm/) que
ha encontrado este fallo y lo ha reportado oportunamente mencionan las
siguientes recomendaciones:

- Instale los parches disponibles en el sitio web de Schneider Electric.
- Si está utilizando la NMC, cambie la contraseña predeterminada de la NMC ("apc") e instale un certificado SSL firmado públicamente para que un atacante en su red no pueda interceptar la nueva contraseña. Para limitar aún más la superficie de ataque de su NMC, consulte el Manual de seguridad de Schneider Electric para NMC2 y NMC3.
- Implemente listas de control de acceso (ACL) en las que los dispositivos UPS solo pueden comunicarse con un pequeño conjunto de dispositivos de administración y Schneider Electric Cloud a través de comunicaciones cifradas.